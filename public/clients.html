<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="ISP Management System Clients">
  <title>ISP Management System - Clients</title>
  
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  
  <!-- Tailwind CSS -->
  
  
  
  
  <!-- Tailwind CSS CDN -->
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 font-inter">
  <div class="flex h-screen overflow-hidden">
    <!-- Mobile Menu Overlay -->
    <div id="mobileMenuOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 lg:hidden hidden"></div>
    
    <!-- Sidebar -->
    <aside id="sidebar" class="w-64 bg-gradient-to-b from-blue-700 to-blue-800 text-white shadow-xl flex flex-col fixed lg:static inset-y-0 left-0 z-50 transform -translate-x-full lg:translate-x-0 transition-transform duration-300 ease-in-out">
      <!-- Logo -->
      <div class="p-6 border-b border-blue-600">
        <a href="/dashboard.html" class="flex items-center space-x-3 hover:opacity-90 transition-opacity">
          <i class="fas fa-signal text-2xl"></i>
          <h1 class="text-xl font-bold">ISP Management</h1>
        </a>
      </div>
      
      <!-- Navigation -->
      <nav class="flex-1 px-4 py-6 space-y-1 overflow-y-auto">
        <a href="/dashboard.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-white/90 hover:text-white">
          <i class="fas fa-tachometer-alt w-5"></i>
          <span>Dashboard</span>
        </a>
        <a href="/clients.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg bg-white/20 text-white font-medium">
          <i class="fas fa-users w-5"></i>
          <span>Clients</span>
        </a>
        <a href="/plans.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-white/90 hover:text-white">
          <i class="fas fa-project-diagram w-5"></i>
          <span>Plans</span>
        </a>
        <a href="/billings.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-white/90 hover:text-white">
          <i class="fas fa-file-invoice-dollar w-5"></i>
          <span>Billings</span>
        </a>
        <a href="/payments.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-white/90 hover:text-white">
          <i class="fas fa-credit-card w-5"></i>
          <span>Payments</span>
        </a>
        <a href="/assets.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-white/90 hover:text-white">
          <i class="fas fa-cube w-5"></i>
          <span>Assets</span>
        </a>
        <a href="/inventory.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-white/90 hover:text-white">
          <i class="fas fa-boxes w-5"></i>
          <span>Inventory</span>
        </a>
        <a href="/tickets.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-white/90 hover:text-white">
          <i class="fas fa-ticket-alt w-5"></i>
          <span>Tickets</span>
        </a>
        <a href="/monitoring.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-white/90 hover:text-white">
          <i class="fas fa-chart-line w-5"></i>
          <span>Monitoring</span>
        </a>
        <a href="/settings.html" class="flex items-center space-x-3 px-4 py-3 rounded-lg hover:bg-white/10 transition-colors text-white/90 hover:text-white">
          <i class="fas fa-cogs w-5"></i>
          <span>Settings</span>
        </a>
      </nav>
      
      <!-- User Info -->
      <div class="p-4 border-t border-blue-600">
        <div class="flex items-center justify-between">
          <div class="flex items-center space-x-3">
            <i class="fas fa-user-circle text-2xl"></i>
            <span id="username" class="font-medium">Loading...</span>
          </div>
          <button 
            id="logoutBtn"
            class="px-3 py-2 bg-white/20 hover:bg-white/30 rounded-lg transition-colors text-sm font-medium"
          >
            <i class="fas fa-sign-out-alt"></i>
          </button>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <div class="flex-1 flex flex-col overflow-hidden">
      <!-- Top Header -->
      <header class="bg-white shadow-sm border-b border-gray-200 px-4 lg:px-6 py-4">
        <div class="flex items-center justify-between">
          <div class="flex items-center">
            <!-- Mobile Menu Button -->
            <button id="mobileMenuBtn" class="lg:hidden mr-4 p-2 rounded-md text-gray-600 hover:text-gray-900 hover:bg-gray-100 focus:outline-none focus:ring-2 focus:ring-blue-500">
              <i class="fas fa-bars text-xl"></i>
            </button>
            <h2 class="text-xl lg:text-2xl font-bold text-gray-900">Clients</h2>
          </div>
          <div class="flex items-center space-x-4">
            <span class="text-gray-600 text-sm hidden sm:block">Manage your client information</span>
          </div>
        </div>
      </header>

      <!-- Main Content Area -->
      <main class="flex-1 overflow-y-auto bg-gray-100 px-4 lg:px-6 py-6 lg:py-8">

    <!-- Client List Card -->
    <div class="bg-white rounded-xl shadow-sm border border-gray-200">
      <div class="px-4 lg:px-6 py-4 border-b border-gray-200">
        <div class="flex flex-col space-y-4">
          <h3 class="text-lg font-semibold text-gray-900 flex items-center">
            <i class="fas fa-users text-blue-600 mr-2"></i>
            Client Management
          </h3>
          
          <!-- Mobile-responsive controls -->
          <div class="flex flex-col space-y-3 lg:flex-row lg:items-center lg:justify-between lg:space-y-0">
            <!-- Search and Filters Row -->
            <div class="flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2 lg:flex-1">
              <input 
                type="text" 
                id="clientSearch" 
                placeholder="Search clients..." 
                class="w-full sm:flex-1 lg:w-64 px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              >
              <select 
                id="statusFilter" 
                class="w-full sm:w-auto px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="">All Status</option>
                <option value="active">Active</option>
                <option value="inactive">Inactive</option>
              </select>
              <select 
                id="paymentStatusFilter" 
                class="w-full sm:w-auto px-3 py-2 text-sm border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
              >
                <option value="">All Payments</option>
                <option value="paid">Paid</option>
                <option value="unpaid">Unpaid</option>
              </select>
              <select id="itemsPerPage" class="w-full sm:w-auto px-2 py-1 border border-gray-300 rounded text-sm">
                <option value="10">10</option>
                <option value="25" selected>25</option>
                <option value="50">50</option>
                <option value="100">100</option>
                <option value="250">250</option>
                <option value="500">500</option>
                <option value="1000">All</option>
              </select>
            </div>
            
            <!-- Action Buttons Row -->
            <div class="flex flex-col space-y-2 sm:flex-row sm:space-y-0 sm:space-x-2 lg:space-x-3">
              <button 
                id="importMikrotikBtn" 
                onclick="openImportModal()"
                class="flex items-center justify-center space-x-2 px-3 py-2 lg:px-4 lg:py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 hover:border-gray-400 transition-all duration-200 font-medium text-sm"
              >
                <i class="fas fa-file-import"></i>
                <span class="hidden sm:inline">Import from MikroTik</span>
                <span class="sm:hidden">Import</span>
              </button>
              <button 
                id="deleteAllBtn" 
                onclick="confirmDeleteAll()"
                class="flex items-center justify-center space-x-2 px-3 py-2 lg:px-4 lg:py-2 border border-red-300 text-red-700 rounded-lg hover:bg-red-50 hover:border-red-400 transition-all duration-200 font-medium text-sm"
              >
                <i class="fas fa-trash-alt"></i>
                <span class="hidden sm:inline">Delete All</span>
                <span class="sm:hidden">Clear</span>
              </button>
              <button 
                id="addClientBtn" 
                onclick="openAddModal()"
                class="flex items-center justify-center space-x-2 px-3 py-2 lg:px-4 lg:py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors font-medium text-sm"
              >
                <i class="fas fa-user-plus"></i>
                <span>Add Client</span>
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <!-- Desktop Table View -->
      <div class="hidden lg:block overflow-x-auto">
        <table class="w-full">
          <thead class="bg-gray-50">
            <tr>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortClients('id')">
                ID <i id="sort-id" class="fas fa-sort ml-1 text-gray-400"></i>
              </th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortClients('name')">
                Name <i id="sort-name" class="fas fa-sort ml-1 text-gray-400"></i>
              </th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortClients('address')">
                Address <i id="sort-address" class="fas fa-sort ml-1 text-gray-400"></i>
              </th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortClients('installation_date')">
                Installation Date <i id="sort-installation_date" class="fas fa-sort ml-1 text-gray-400"></i>
              </th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortClients('due_date')">
                Due Date <i id="sort-due_date" class="fas fa-sort ml-1 text-gray-400"></i>
              </th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortClients('payment_status')">
                Payment Status <i id="sort-payment_status" class="fas fa-sort ml-1 text-gray-400"></i>
              </th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortClients('status')">
                Status <i id="sort-status" class="fas fa-sort ml-1 text-gray-400"></i>
              </th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer hover:bg-gray-100" onclick="sortClients('balance')">
                Balance <i id="sort-balance" class="fas fa-sort ml-1 text-gray-400"></i>
              </th>
              <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Plan</th>
              <th class="px-4 py-2 text-right text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody id="clientsTableBody" class="bg-white divide-y divide-gray-200">
            <tr>
              <td colspan="10" class="px-4 py-8 text-center">
                <div class="flex items-center justify-center">
                  <div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mr-3"></div>
                  <span class="text-gray-500">Loading clients...</span>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>

      <!-- Mobile Card View -->
      <div class="lg:hidden" id="clientsCardView">
        <div class="px-4 py-8 text-center">
          <div class="flex items-center justify-center">
            <div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mr-3"></div>
            <span class="text-gray-500">Loading clients...</span>
          </div>
        </div>
      </div>
      
      <!-- Pagination Controls -->
      <div class="px-4 lg:px-6 py-4 border-t border-gray-200">
        <div class="flex flex-col space-y-3 sm:flex-row sm:items-center sm:justify-between sm:space-y-0">
          <div class="text-sm text-gray-700 text-center sm:text-left">
            <span id="paginationStatus">Showing 0 to 0 of 0 entries</span>
          </div>
          <div class="flex items-center justify-center space-x-1 sm:space-x-2">
            <button 
              id="prevPageBtn" 
              onclick="changePage(-1)" 
              class="px-2 py-1 lg:px-3 lg:py-1 text-xs lg:text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              disabled
            >
              <i class="fas fa-chevron-left mr-1"></i>
              <span class="hidden sm:inline">Previous</span>
            </button>
            <div id="pageNumbers" class="flex space-x-1">
              <!-- Page numbers will be inserted here -->
            </div>
            <button 
              id="nextPageBtn" 
              onclick="changePage(1)" 
              class="px-2 py-1 lg:px-3 lg:py-1 text-xs lg:text-sm border border-gray-300 rounded hover:bg-gray-50 disabled:opacity-50 disabled:cursor-not-allowed"
              disabled
            >
              <span class="hidden sm:inline">Next</span>
              <i class="fas fa-chevron-right ml-1"></i>
            </button>
          </div>
        </div>
        </div>
      </main>
    </div>
  </div>

  <!-- Add Client Modal -->
  <div id="addClientModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto mx-auto">
      <div class="px-4 py-4 lg:px-6 border-b border-gray-200 flex items-center justify-between">
        <h3 class="text-lg font-semibold text-gray-900">Add New Client</h3>
        <button type="button" onclick="closeAddModal()" class="text-gray-400 hover:text-gray-600 lg:hidden">
          <i class="fas fa-times text-xl"></i>
        </button>
      </div>
      
      <form id="addClientForm" class="p-4 lg:p-6 space-y-4">
        <div>
          <label for="clientName" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
          <input 
            type="text" 
            id="clientName" 
            name="name" 
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Client name"
          >
        </div>
        
        <div>
          <label for="clientEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <input 
            type="email" 
            id="clientEmail" 
            name="email" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="client@example.com"
          >
        </div>
        
        <div>
          <label for="clientPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
          <input 
            type="tel" 
            id="clientPhone" 
            name="phone" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Phone number"
          >
        </div>
        
        <div>
          <label for="clientAddress" class="block text-sm font-medium text-gray-700 mb-1">Address</label>
          <textarea 
            id="clientAddress" 
            name="address" 
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="Client address"
          ></textarea>
        </div>
        
        <div>
          <label for="clientPlan" class="block text-sm font-medium text-gray-700 mb-1">Internet Plan</label>
          <select 
            id="clientPlan" 
            name="plan_id" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="">No Plan Selected</option>
          </select>
        </div>
        
        <div>
          <label for="clientInstallationDate" class="block text-sm font-medium text-gray-700 mb-1">Installation Date</label>
          <input 
            type="date" 
            id="clientInstallationDate" 
            name="installation_date" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
        
        <div>
          <label for="clientDueDate" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
          <input 
            type="date" 
            id="clientDueDate" 
            name="due_date" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
        
        <div>
          <label for="clientPaymentStatus" class="block text-sm font-medium text-gray-700 mb-1">Payment Status</label>
          <select 
            id="clientPaymentStatus" 
            name="payment_status" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="unpaid">Unpaid</option>
            <option value="paid">Paid</option>
          </select>
        </div>
        
        <div>
          <label for="clientBalance" class="block text-sm font-medium text-gray-700 mb-1">Balance</label>
          <input 
            type="number" 
            id="clientBalance" 
            name="balance" 
            step="0.01"
            min="0"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="0.00"
          >
          <p class="text-xs text-gray-500 mt-1">Outstanding balance amount (₱)</p>
        </div>
        
        
        <div class="flex justify-end space-x-3 pt-4">
          <button 
            type="button" 
            onclick="closeAddModal()"
            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
          >
            Cancel
          </button>
          <button 
            type="submit"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            Add Client
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Client Modal -->
  <div id="editClientModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-xl max-w-md w-full max-h-[90vh] overflow-y-auto">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Edit Client</h3>
      </div>
      
      <form id="editClientForm" class="p-6 space-y-4">
        <input type="hidden" id="editClientId" name="id">
        
        <div>
          <label for="editClientName" class="block text-sm font-medium text-gray-700 mb-1">Name</label>
          <input 
            type="text" 
            id="editClientName" 
            name="name" 
            required
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
        
        <div>
          <label for="editClientEmail" class="block text-sm font-medium text-gray-700 mb-1">Email</label>
          <input 
            type="email" 
            id="editClientEmail" 
            name="email" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
        
        <div>
          <label for="editClientPhone" class="block text-sm font-medium text-gray-700 mb-1">Phone</label>
          <input 
            type="tel" 
            id="editClientPhone" 
            name="phone" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
        
        <div>
          <label for="editClientAddress" class="block text-sm font-medium text-gray-700 mb-1">Address</label>
          <textarea 
            id="editClientAddress" 
            name="address" 
            rows="3"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          ></textarea>
        </div>
        
        <div>
          <label for="editClientPlan" class="block text-sm font-medium text-gray-700 mb-1">Internet Plan</label>
          <select 
            id="editClientPlan" 
            name="plan_id" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="">No Plan Selected</option>
          </select>
        </div>
        
        <div>
          <label for="editClientInstallationDate" class="block text-sm font-medium text-gray-700 mb-1">Installation Date</label>
          <input 
            type="date" 
            id="editClientInstallationDate" 
            name="installation_date" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
        
        <div>
          <label for="editClientDueDate" class="block text-sm font-medium text-gray-700 mb-1">Due Date</label>
          <input 
            type="date" 
            id="editClientDueDate" 
            name="due_date" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
        </div>
        
        <div>
          <label for="editClientPaymentStatus" class="block text-sm font-medium text-gray-700 mb-1">Payment Status</label>
          <select 
            id="editClientPaymentStatus" 
            name="payment_status" 
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
          >
            <option value="unpaid">Unpaid</option>
            <option value="paid">Paid</option>
          </select>
        </div>
        
        <div>
          <label for="editClientBalance" class="block text-sm font-medium text-gray-700 mb-1">Balance</label>
          <input 
            type="number" 
            id="editClientBalance" 
            name="balance" 
            step="0.01"
            min="0"
            class="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-blue-500"
            placeholder="0.00"
          >
          <p class="text-xs text-gray-500 mt-1">Outstanding balance amount (₱)</p>
        </div>
        
        <div class="flex justify-end space-x-3 pt-4">
          <button 
            type="button" 
            onclick="closeEditModal()"
            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
          >
            Cancel
          </button>
          <button 
            type="submit"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
          >
            Update Client
          </button>
        </div>
      </form>
    </div>
  </div>

  <!-- Import Modal -->
  <div id="importModal" class="fixed inset-0 bg-black bg-opacity-50 hidden items-center justify-center z-50 p-4">
    <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
      <div class="px-6 py-4 border-b border-gray-200">
        <h3 class="text-lg font-semibold text-gray-900">Import Clients from MikroTik</h3>
      </div>
      
      <div class="p-6">
        <div id="importContent">
          <!-- Loading State -->
          <div id="importLoading" class="text-center py-12">
            <div class="w-12 h-12 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-4"></div>
            <p class="text-gray-500">Connecting to MikroTik router...</p>
          </div>
          
          <!-- Error State -->
          <div id="importError" class="hidden text-center py-12">
            <div class="w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mx-auto mb-4">
              <i class="fas fa-exclamation-triangle text-red-600 text-2xl"></i>
            </div>
            <h4 class="text-lg font-semibold text-gray-900 mb-2">Connection Failed</h4>
            <p id="importErrorMessage" class="text-gray-600 mb-4">Unable to connect to MikroTik router.</p>
            <button 
              onclick="fetchMikroTikAccounts()" 
              class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            >
              Retry Connection
            </button>
          </div>
          
          <!-- Success State -->
          <div id="importAccounts" class="hidden">
            <div class="mb-4">
              <p class="text-gray-600 mb-4">Select PPPoE accounts to import as clients:</p>
              <div class="flex items-center justify-between mb-4">
                <div class="flex items-center space-x-4">
                  <button 
                    onclick="selectAllAccounts()" 
                    class="text-sm text-blue-600 hover:text-blue-800"
                  >
                    Select All
                  </button>
                  <button 
                    onclick="selectAllNewClients()" 
                    class="text-sm text-green-600 hover:text-green-800"
                  >
                    Select All New Clients
                  </button>
                  <button 
                    onclick="selectNoneAccounts()" 
                    class="text-sm text-blue-600 hover:text-blue-800"
                  >
                    Select None
                  </button>
                </div>
                <span id="selectedCount" class="text-sm text-gray-500">0 selected</span>
              </div>
            </div>
            
            <div class="max-h-96 overflow-y-auto border border-gray-200 rounded-lg">
              <table class="w-full">
                <thead class="bg-gray-50 sticky top-0">
                  <tr>
                    <th class="px-4 py-2 text-left">
                      <input 
                        type="checkbox" 
                        id="selectAllCheckbox" 
                        onchange="toggleAllAccounts(this)"
                        class="rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500"
                      >
                    </th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Account Name</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Profile</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Comment</th>
                    <th class="px-4 py-2 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                  </tr>
                </thead>
                <tbody id="accountsList" class="bg-white divide-y divide-gray-200">
                  <!-- Accounts will be populated here -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
        
        <div class="flex justify-end space-x-3 pt-6 border-t border-gray-200 mt-6">
          <button 
            type="button" 
            onclick="closeImportModal()"
            class="px-4 py-2 border border-gray-300 text-gray-700 rounded-lg hover:bg-gray-50 transition-colors"
          >
            Cancel
          </button>
          <button 
            id="importSelectedBtn"
            onclick="importSelectedAccounts()"
            class="px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors disabled:bg-gray-300 disabled:cursor-not-allowed"
            disabled
          >
            Import Selected
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast Container -->
  <div id="notificationContainer" class="fixed bottom-4 right-4 z-50 space-y-2 max-w-sm"></div>

  <script>
    // Global variables
    let clients = [];
    let plans = [];
    let currentPage = 1;
    let itemsPerPage = 25;
    let totalPages = 1;
    let sortField = 'id';
    let sortDirection = 'asc';

    // Show notification toast
    function showNotification(title, message, type = 'info') {
      const container = document.getElementById('notificationContainer');
      
      const toastId = 'toast-' + Math.random().toString(36).substring(2, 15);
      
      let bgClass = 'bg-blue-500';
      let icon = 'info-circle';
      
      switch(type) {
        case 'success':
          icon = 'check-circle';
          bgClass = 'bg-green-500';
          break;
        case 'warning':
          icon = 'exclamation-triangle';
          bgClass = 'bg-amber-500';
          break;
        case 'error':
          icon = 'exclamation-circle';
          bgClass = 'bg-red-500';
          break;
      }
      
      const toast = document.createElement('div');
      toast.id = toastId;
      toast.className = `${bgClass} text-white px-4 py-3 rounded-lg shadow-lg transform transition-all duration-300 translate-x-full opacity-0`;
      toast.innerHTML = `
        <div class="flex items-start">
          <i class="fas fa-${icon} mt-0.5 mr-3 flex-shrink-0"></i>
          <div class="flex-1 min-w-0">
            <div class="font-semibold">${title}</div>
            <div class="text-sm opacity-90">${message}</div>
          </div>
          <button onclick="removeToast('${toastId}')" class="ml-3 flex-shrink-0 text-white/80 hover:text-white">
            <i class="fas fa-times"></i>
          </button>
        </div>
      `;
      
      container.appendChild(toast);
      
      setTimeout(() => {
        toast.classList.remove('translate-x-full', 'opacity-0');
      }, 10);
      
      setTimeout(() => {
        removeToast(toastId);
      }, 5000);
    }
    
    function removeToast(toastId) {
      const toast = document.getElementById(toastId);
      if (toast) {
        toast.classList.add('translate-x-full', 'opacity-0');
        setTimeout(() => {
          toast.remove();
        }, 300);
      }
    }

    // Modal functions
    function openAddModal() {
      document.getElementById('addClientModal').classList.remove('hidden');
      document.getElementById('addClientModal').classList.add('flex');
    }

    function closeAddModal() {
      document.getElementById('addClientModal').classList.add('hidden');
      document.getElementById('addClientModal').classList.remove('flex');
      document.getElementById('addClientForm').reset();
    }

    async function openEditModal(clientId) {
      const client = clients.find(c => c.id === clientId);
      if (!client) return;

      document.getElementById('editClientId').value = client.id;
      document.getElementById('editClientName').value = client.name;
      document.getElementById('editClientEmail').value = client.email || '';
      document.getElementById('editClientPhone').value = client.phone || '';
      document.getElementById('editClientAddress').value = client.address || '';
      document.getElementById('editClientPlan').value = client.plan_id || '';
      
      // Set new fields
      document.getElementById('editClientInstallationDate').value = client.installation_date ? 
        client.installation_date.split('T')[0] : '';
      document.getElementById('editClientDueDate').value = client.due_date ? 
        client.due_date.split('T')[0] : '';
      document.getElementById('editClientPaymentStatus').value = client.payment_status || 'unpaid';
      document.getElementById('editClientBalance').value = client.balance || '0.00';
      

      document.getElementById('editClientModal').classList.remove('hidden');
      document.getElementById('editClientModal').classList.add('flex');
    }

    function closeEditModal() {
      document.getElementById('editClientModal').classList.add('hidden');
      document.getElementById('editClientModal').classList.remove('flex');
      document.getElementById('editClientForm').reset();
    }

    function openImportModal() {
      document.getElementById('importModal').classList.remove('hidden');
      document.getElementById('importModal').classList.add('flex');
      
      // Reset modal state
      showImportState('loading');
      
      // Fetch MikroTik accounts
      fetchMikroTikAccounts();
    }

    function closeImportModal() {
      document.getElementById('importModal').classList.add('hidden');
      document.getElementById('importModal').classList.remove('flex');
    }

    async function viewClient(clientId) {
      const client = clients.find(c => c.id === clientId);
      if (!client) {
        showNotification('Error', 'Client not found', 'error');
        return;
      }
      
      // Create a larger view modal showing client details with tabs
      const viewModal = document.createElement('div');
      viewModal.className = 'fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4';
      viewModal.innerHTML = `
        <div class="bg-white rounded-xl shadow-xl max-w-4xl w-full max-h-[90vh] overflow-hidden">
          <div class="px-6 py-4 border-b border-gray-200">
            <h3 class="text-lg font-semibold text-gray-900">Client Details - ${client.name}</h3>
          </div>
          
          <!-- Tab Navigation -->
          <div class="border-b border-gray-200">
            <nav class="flex space-x-8 px-6">
              <button 
                onclick="switchTab('details')"
                class="tab-button py-2 px-1 border-b-2 border-blue-500 text-blue-600 font-medium text-sm active"
              >
                Details
              </button>
              <button 
                onclick="switchTab('billing')"
                class="tab-button py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm"
              >
                Billing History
              </button>
              <button 
                onclick="switchTab('payments')"
                class="tab-button py-2 px-1 border-b-2 border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300 font-medium text-sm"
              >
                Payment History
              </button>
            </nav>
          </div>
          
          <div class="p-6 overflow-y-auto max-h-[calc(90vh-160px)]">
            <!-- Details Tab -->
            <div id="details-tab" class="tab-content">
              <div class="space-y-4">
                <div>
                  <label class="block text-sm font-medium text-gray-700">ID</label>
                  <p class="mt-1 text-sm text-gray-900">${client.id}</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Name</label>
                  <p class="mt-1 text-sm text-gray-900">${client.name}</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Email</label>
                  <p class="mt-1 text-sm text-gray-900">${client.email || 'Not provided'}</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Phone</label>
                  <p class="mt-1 text-sm text-gray-900">${client.phone || 'Not provided'}</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Address</label>
                  <p class="mt-1 text-sm text-gray-900">${client.address || 'Not provided'}</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Current Plan</label>
                  <p class="mt-1 text-sm text-gray-900">${client.plan_name || 'No Plan'}</p>
                </div>
                <div>
                  <label class="block text-sm font-medium text-gray-700">Status</label>
                  <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full bg-green-100 text-green-800">
                    Active
                  </span>
                </div>
              </div>
            </div>
            
            <!-- Billing History Tab -->
            <div id="billing-tab" class="tab-content hidden">
              <div class="mb-4">
                <h4 class="text-lg font-medium text-gray-900 mb-2">Billing History</h4>
                <div id="billing-loading" class="text-center py-8">
                  <div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"></div>
                  <p class="text-gray-500">Loading billing history...</p>
                </div>
                <div id="billing-content" class="hidden">
                  <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                      <thead class="bg-gray-50">
                        <tr>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">Period</th>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">Current Charges</th>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">Previous Charges</th>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">Prev Payments</th>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">Total Amount Due</th>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">Status</th>
                        </tr>
                      </thead>
                      <tbody id="billing-list" class="divide-y divide-gray-200">
                        <!-- Billing data will be populated here -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
            
            <!-- Payment History Tab -->
            <div id="payments-tab" class="tab-content hidden">
              <div class="mb-4">
                <h4 class="text-lg font-medium text-gray-900 mb-2">Payment History</h4>
                <div id="payments-loading" class="text-center py-8">
                  <div class="w-8 h-8 border-4 border-blue-600 border-t-transparent rounded-full animate-spin mx-auto mb-2"></div>
                  <p class="text-gray-500">Loading payment history...</p>
                </div>
                <div id="payments-content" class="hidden">
                  <div class="overflow-x-auto">
                    <table class="w-full text-sm">
                      <thead class="bg-gray-50">
                        <tr>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">Date</th>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">Payments</th>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">Previous Balance</th>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">New Balance</th>
                          <th class="px-3 py-1.5 text-left text-xs font-medium text-gray-500 uppercase">Method</th>
                        </tr>
                      </thead>
                      <tbody id="payments-list" class="divide-y divide-gray-200">
                        <!-- Payment data will be populated here -->
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <div class="px-6 py-4 border-t border-gray-200">
            <button 
              onclick="this.closest('.fixed').remove()"
              class="w-full px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 transition-colors"
            >
              Close
            </button>
          </div>
        </div>
      `;
      
      document.body.appendChild(viewModal);
      
      // Add tab switching functionality
      window.switchTab = function(tabName) {
        // Hide all tab contents
        const tabContents = viewModal.querySelectorAll('.tab-content');
        tabContents.forEach(content => content.classList.add('hidden'));
        
        // Remove active class from all tab buttons
        const tabButtons = viewModal.querySelectorAll('.tab-button');
        tabButtons.forEach(button => {
          button.classList.remove('border-blue-500', 'text-blue-600', 'active');
          button.classList.add('border-transparent', 'text-gray-500');
        });
        
        // Show selected tab content
        const selectedTab = viewModal.querySelector(`#${tabName}-tab`);
        if (selectedTab) {
          selectedTab.classList.remove('hidden');
        }
        
        // Add active class to selected tab button
        const selectedButton = viewModal.querySelector(`button[onclick="switchTab('${tabName}')"]`);
        if (selectedButton) {
          selectedButton.classList.add('border-blue-500', 'text-blue-600', 'active');
          selectedButton.classList.remove('border-transparent', 'text-gray-500');
        }
        
        // Load data for the selected tab
        if (tabName === 'billing') {
          loadClientBillingHistory(clientId);
        } else if (tabName === 'payments') {
          loadClientPaymentHistory(clientId);
        }
      };
      
      // Close modal when clicking outside
      viewModal.addEventListener('click', function(e) {
        if (e.target === viewModal) {
          viewModal.remove();
          delete window.switchTab;
        }
      });
    }

    // Load billing history for a specific client
    async function loadClientBillingHistory(clientId) {
      const token = localStorage.getItem('auth_token');
      const billingLoading = document.getElementById('billing-loading');
      const billingContent = document.getElementById('billing-content');
      const billingList = document.getElementById('billing-list');
      
      billingLoading.classList.remove('hidden');
      billingContent.classList.add('hidden');
      
      try {
        const response = await fetch(`/api/billings?client_id=${clientId}`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const billings = await response.json();
          
          if (billings.length === 0) {
            billingList.innerHTML = `
              <tr>
                <td colspan="6" class="px-4 py-8 text-center text-gray-500">
                  No billing history found for this client.
                </td>
              </tr>
            `;
          } else {
            billingList.innerHTML = billings.map(billing => `
              <tr class="hover:bg-gray-50">
                <td class="px-4 py-2 text-sm text-gray-900">
                  ${billing.period || 'N/A'}
                </td>
                <td class="px-4 py-2 text-sm font-semibold text-gray-900">
                  ₱${parseFloat(billing.amount || 0).toFixed(2)}
                </td>
                <td class="px-4 py-2 text-sm ${parseFloat(billing.prev_balance || 0) > 0 ? 'text-red-600 font-medium' : 'text-gray-500'}">
                  ₱${parseFloat(billing.prev_balance || 0).toFixed(2)}
                </td>
                <td class="px-4 py-2 text-sm text-green-600 font-medium">
                  ₱${parseFloat(billing.prev_payments || 0).toFixed(2)}
                </td>
                <td class="px-4 py-2 text-sm font-semibold text-gray-900">
                  ₱${parseFloat(billing.total_amount_due || billing.amount || 0).toFixed(2)}
                </td>
                <td class="px-4 py-2 text-sm">
                  <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                    billing.status === 'paid' ? 'bg-green-100 text-green-800' :
                    billing.status === 'pending' ? 'bg-yellow-100 text-yellow-800' :
                    'bg-red-100 text-red-800'
                  }">
                    ${billing.status.charAt(0).toUpperCase() + billing.status.slice(1)}
                  </span>
                </td>
              </tr>
            `).join('');
          }
          
          billingLoading.classList.add('hidden');
          billingContent.classList.remove('hidden');
        } else {
          throw new Error('Failed to load billing history');
        }
      } catch (error) {
        console.error('Error loading billing history:', error);
        billingList.innerHTML = `
          <tr>
            <td colspan="6" class="px-4 py-8 text-center text-red-500">
              Failed to load billing history. Please try again.
            </td>
          </tr>
        `;
        billingLoading.classList.add('hidden');
        billingContent.classList.remove('hidden');
      }
    }
    
    // Load payment history for a specific client
    async function loadClientPaymentHistory(clientId) {
      const token = localStorage.getItem('auth_token');
      const paymentsLoading = document.getElementById('payments-loading');
      const paymentsContent = document.getElementById('payments-content');
      const paymentsList = document.getElementById('payments-list');
      
      paymentsLoading.classList.remove('hidden');
      paymentsContent.classList.add('hidden');
      
      try {
        const response = await fetch(`/api/payments?client_id=${clientId}`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const payments = await response.json();
          
          if (payments.length === 0) {
            paymentsList.innerHTML = `
              <tr>
                <td colspan="5" class="px-4 py-8 text-center text-gray-500">
                  No payment history found for this client.
                </td>
              </tr>
            `;
          } else {
            paymentsList.innerHTML = payments.map(payment => {
              const paymentDate = new Date(payment.payment_date);
              const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 
                             'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
              const month = months[paymentDate.getMonth()];
              const day = String(paymentDate.getDate()).padStart(2, '0');
              const year = paymentDate.getFullYear();
              const hours = String(paymentDate.getHours()).padStart(2, '0');
              const minutes = String(paymentDate.getMinutes()).padStart(2, '0');
              const seconds = String(paymentDate.getSeconds()).padStart(2, '0');
              const formattedDate = `${month}-${day}-${year} ${hours}:${minutes}:${seconds}`;
              
              return `
                <tr class="hover:bg-gray-50">
                  <td class="px-4 py-2 text-sm text-gray-900">
                    ${formattedDate}
                  </td>
                  <td class="px-4 py-2 text-sm font-semibold text-gray-900">
                    ₱${parseFloat(payment.amount || 0).toFixed(2)}
                  </td>
                  <td class="px-4 py-2 text-sm ${parseFloat(payment.prev_balance || 0) > 0 ? 'text-red-600 font-medium' : parseFloat(payment.prev_balance || 0) < 0 ? 'text-green-600 font-medium' : 'text-gray-500'}">
                    ₱${parseFloat(payment.prev_balance || 0).toFixed(2)}
                  </td>
                  <td class="px-4 py-2 text-sm ${parseFloat(payment.new_balance || 0) > 0 ? 'text-red-600 font-medium' : parseFloat(payment.new_balance || 0) < 0 ? 'text-green-600 font-medium' : 'text-gray-500'}">
                    ₱${parseFloat(payment.new_balance || 0).toFixed(2)}
                  </td>
                  <td class="px-4 py-2 text-sm text-gray-900">
                    ${payment.method || payment.payment_method || 'N/A'}
                  </td>
                </tr>
              `;
            }).join('');
          }
          
          paymentsLoading.classList.add('hidden');
          paymentsContent.classList.remove('hidden');
        } else {
          throw new Error('Failed to load payment history');
        }
      } catch (error) {
        console.error('Error loading payment history:', error);
        paymentsList.innerHTML = `
          <tr>
            <td colspan="5" class="px-4 py-8 text-center text-red-500">
              Failed to load payment history. Please try again.
            </td>
          </tr>
        `;
        paymentsLoading.classList.add('hidden');
        paymentsContent.classList.remove('hidden');
      }
    }

    async function deleteClient(clientId) {
      if (!confirm('Are you sure you want to delete this client? This action cannot be undone.')) return;
      
      const token = localStorage.getItem('auth_token');
      
      try {
        const response = await fetch(`/api/clients/${clientId}`, {
          method: 'DELETE',
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          showNotification('Success', 'Client has been successfully deleted', 'success');
          loadClients();
        } else {
          const error = await response.json();
          throw new Error(error.error || 'Failed to delete client');
        }
      } catch (error) {
        console.error('Error deleting client:', error);
        showNotification('Error', `Failed to delete client: ${error.message}`, 'error');
      }
    }

    // Load and display clients with pagination and sorting
    async function loadClients() {
      const token = localStorage.getItem('auth_token');
      
      try {
        const params = new URLSearchParams({
          page: currentPage,
          limit: itemsPerPage,
          sortBy: sortField,
          sortOrder: sortDirection,
          search: document.getElementById('clientSearch')?.value || '',
          status: document.getElementById('statusFilter')?.value || '',
          paymentStatus: document.getElementById('paymentStatusFilter')?.value || ''
        });
        
        console.log('Fetching clients with params:', params.toString());
        
        const response = await fetch(`/api/clients?${params}`, {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          console.log('Clients data received:', data);
          clients = data.clients || [];
          totalPages = data.pagination?.totalPages || 1;
          const totalCount = data.pagination?.totalCount || 0;
          console.log(`Loaded page ${currentPage} of ${totalPages}, total items: ${totalCount}`);
          updatePaginationInfo(totalCount);
          renderClients();
          updatePaginationControls();
        } else {
          throw new Error('Failed to load clients');
        }
      } catch (error) {
        console.error('Error loading clients:', error);
        showNotification('Error', 'Failed to load clients', 'error');
        
        document.getElementById('clientsTableBody').innerHTML = `
          <tr>
            <td colspan="9" class="px-4 py-8 text-center text-gray-500">
              Failed to load clients. Please try again.
            </td>
          </tr>
        `;
      }
    }

    // Load available plans
    async function loadPlans() {
      const token = localStorage.getItem('auth_token');
      
      try {
        const response = await fetch('/api/plans', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          plans = await response.json();
          populatePlanDropdown();
        } else {
          throw new Error('Failed to load plans');
        }
      } catch (error) {
        console.error('Error loading plans:', error);
        showNotification('Error', 'Failed to load plans', 'error');
      }
    }

    // Populate plan dropdown in both add and edit modals
    function populatePlanDropdown() {
      const planOptions = '<option value="">No Plan Selected</option>' +
        plans.map(plan => `<option value="${plan.id}">${plan.name} - ₱${plan.price}/month</option>`).join('');
      
      const editPlanSelect = document.getElementById('editClientPlan');
      const addPlanSelect = document.getElementById('clientPlan');
      
      if (editPlanSelect) {
        editPlanSelect.innerHTML = planOptions;
      }
      if (addPlanSelect) {
        addPlanSelect.innerHTML = planOptions;
      }
    }

    function renderClients() {
      const tbody = document.getElementById('clientsTableBody');
      
      if (clients.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="10" class="px-4 py-8 text-center text-gray-500">
              No clients found.
            </td>
          </tr>
        `;
        return;
      }

      tbody.innerHTML = clients.map(client => {
        const paymentStatusClass = client.payment_status === 'paid' ? 
          'bg-green-100 text-green-800' : 'bg-red-100 text-red-800';
        const statusClass = client.status === 'active' ? 
          'bg-green-100 text-green-800' : 'bg-gray-100 text-gray-800';
        
        return `
          <tr class="hover:bg-gray-50">
            <td class="px-4 py-2 whitespace-nowrap text-sm font-medium text-gray-900">${client.id}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-900">${client.name}</td>
            <td class="px-4 py-2 text-sm text-gray-500 max-w-xs truncate">${client.address || '-'}</td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">
              ${client.installation_date ? new Date(client.installation_date).toLocaleDateString() : '-'}
            </td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">
              ${client.due_date ? new Date(client.due_date).toLocaleDateString() : '-'}
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${paymentStatusClass}">
                ${client.payment_status ? client.payment_status.charAt(0).toUpperCase() + client.payment_status.slice(1) : 'Unpaid'}
              </span>
            </td>
            <td class="px-4 py-2 whitespace-nowrap">
              <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${statusClass}">
                ${client.status ? client.status.charAt(0).toUpperCase() + client.status.slice(1) : 'Active'}
              </span>
            </td>
            <td class="px-4 py-2 whitespace-nowrap text-sm">
              <span class="${parseFloat(client.balance || 0) > 0 ? 'text-red-600 font-semibold' : 'text-gray-500'}">
                ₱${parseFloat(client.balance || 0).toFixed(2)}
              </span>
            </td>
            <td class="px-4 py-2 whitespace-nowrap text-sm text-gray-500">
              ${client.plan_name || 'No Plan'}
            </td>
            <td class="px-4 py-2 whitespace-nowrap text-right text-sm font-medium space-x-2">
              <button 
                onclick="viewClient(${client.id})"
                class="text-green-600 hover:text-green-900 p-1"
                title="View"
              >
                <i class="fas fa-eye"></i>
              </button>
              <button 
                onclick="openEditModal(${client.id})"
                class="text-blue-600 hover:text-blue-900 p-1"
                title="Edit"
              >
                <i class="fas fa-edit"></i>
              </button>
              <button 
                onclick="deleteClient(${client.id})"
                class="text-red-600 hover:text-red-900 p-1"
                title="Delete"
              >
                <i class="fas fa-trash"></i>
              </button>
            </td>
          </tr>
        `;
      }).join('');
    }

    // Sorting functionality
    function sortClients(field) {
      if (sortField === field) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        sortField = field;
        sortDirection = 'asc';
      }
      
      updateSortIcons();
      currentPage = 1; // Reset to first page when sorting
      loadClients();
    }
    
    function updateSortIcons() {
      // Reset all sort icons
      document.querySelectorAll('[id^="sort-"]').forEach(icon => {
        icon.className = 'fas fa-sort ml-1 text-gray-400';
      });
      
      // Update active sort icon
      const activeIcon = document.getElementById(`sort-${sortField}`);
      if (activeIcon) {
        activeIcon.className = `fas fa-sort-${sortDirection === 'asc' ? 'up' : 'down'} ml-1 text-blue-600`;
      }
    }
    
    // Search and filter functionality
    function filterClients() {
      currentPage = 1; // Reset to first page when filtering
      loadClients();
    }
    
    // Pagination functionality
    function changePage(direction) {
      const newPage = currentPage + direction;
      if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        loadClients();
      }
    }
    
    function goToPage(page) {
      if (page >= 1 && page <= totalPages) {
        currentPage = page;
        loadClients();
      }
    }
    
    function updatePaginationInfo(total) {
      const start = total > 0 ? (currentPage - 1) * itemsPerPage + 1 : 0;
      const end = Math.min(currentPage * itemsPerPage, total);
      
      // Only update paginationStatus element (at bottom of table)
      const paginationStatusEl = document.getElementById('paginationStatus');
      if (paginationStatusEl) {
        paginationStatusEl.textContent = `Showing ${start} to ${end} of ${total} entries`;
      }
    }
    
    function updatePaginationControls() {
      const prevBtn = document.getElementById('prevPageBtn');
      const nextBtn = document.getElementById('nextPageBtn');
      const pageNumbers = document.getElementById('pageNumbers');
      
      // Hide pagination if showing all records or only one page
      if (totalPages <= 1 || itemsPerPage >= 1000) {
        prevBtn.style.display = 'none';
        nextBtn.style.display = 'none';
        pageNumbers.style.display = 'none';
        return;
      }
      
      // Show pagination controls
      prevBtn.style.display = 'inline-flex';
      nextBtn.style.display = 'inline-flex';
      pageNumbers.style.display = 'flex';
      
      // Update previous/next buttons
      prevBtn.disabled = currentPage <= 1;
      nextBtn.disabled = currentPage >= totalPages;
      
      // Generate page numbers
      let pagesHtml = '';
      const maxPagesToShow = 5;
      let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
      let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
      
      // Adjust start page if we're near the end
      if (endPage - startPage + 1 < maxPagesToShow) {
        startPage = Math.max(1, endPage - maxPagesToShow + 1);
      }
      
      // Add first page and ellipsis if needed
      if (startPage > 1) {
        pagesHtml += `
          <button onclick="goToPage(1)" class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50">
            1
          </button>
        `;
        if (startPage > 2) {
          pagesHtml += '<span class="px-2 py-1 text-sm text-gray-500">...</span>';
        }
      }
      
      // Add page numbers
      for (let i = startPage; i <= endPage; i++) {
        const isActive = i === currentPage;
        pagesHtml += `
          <button 
            onclick="goToPage(${i})" 
            class="px-3 py-1 text-sm border rounded ${
              isActive 
                ? 'border-blue-500 bg-blue-50 text-blue-600' 
                : 'border-gray-300 hover:bg-gray-50'
            }"
          >
            ${i}
          </button>
        `;
      }
      
      // Add last page and ellipsis if needed
      if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
          pagesHtml += '<span class="px-2 py-1 text-sm text-gray-500">...</span>';
        }
        pagesHtml += `
          <button onclick="goToPage(${totalPages})" class="px-3 py-1 text-sm border border-gray-300 rounded hover:bg-gray-50">
            ${totalPages}
          </button>
        `;
      }
      
      pageNumbers.innerHTML = pagesHtml;
    }

    // Form submissions
    document.getElementById('addClientForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const allData = Object.fromEntries(formData);
      
      // Separate client data from plan data
      const clientData = {
        name: allData.name,
        email: allData.email,
        phone: allData.phone,
        address: allData.address,
        installation_date: allData.installation_date || null,
        due_date: allData.due_date || null,
        payment_status: allData.payment_status || 'unpaid',
        balance: parseFloat(allData.balance) || 0,
        status: 'active'
      };
      const planId = allData.plan_id;
      
      const token = localStorage.getItem('auth_token');
      
      try {
        // First, create the client
        const clientResponse = await fetch('/api/clients', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(clientData)
        });
        
        if (!clientResponse.ok) {
          throw new Error('Failed to add client');
        }
        
        const clientResult = await clientResponse.json();
        const newClientId = clientResult.client.id;
        
        // If a plan is selected, assign it to the client
        if (planId) {
          const planAssignmentData = {
            client_id: newClientId,
            plan_id: planId,
            status: 'active'
          };
          
          
          const planResponse = await fetch('/api/client-plans', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(planAssignmentData)
          });
          
          if (!planResponse.ok) {
            // Client was created but plan assignment failed
            showNotification('Warning', 'Client added but plan assignment failed', 'warning');
            closeAddModal();
            loadClients();
            return;
          }
        }
        
        showNotification('Success', 'Client added successfully', 'success');
        closeAddModal();
        loadClients();
      } catch (error) {
        console.error('Error adding client:', error);
        showNotification('Error', 'Failed to add client', 'error');
      }
    });

    document.getElementById('editClientForm').addEventListener('submit', async function(e) {
      e.preventDefault();
      
      const formData = new FormData(e.target);
      const allData = Object.fromEntries(formData);
      const clientId = allData.id;
      
      // Separate client data from plan data
      const clientData = {
        name: allData.name,
        email: allData.email,
        phone: allData.phone,
        address: allData.address,
        installation_date: allData.installation_date || null,
        due_date: allData.due_date || null,
        payment_status: allData.payment_status || 'unpaid',
        balance: parseFloat(allData.balance) || 0,
        status: allData.status || 'active'
      };
      const planId = allData.plan_id;
      
      const token = localStorage.getItem('auth_token');
      
      try {
        // Update client basic info
        const clientResponse = await fetch(`/api/clients/${clientId}`, {
          method: 'PUT',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify(clientData)
        });
        
        if (!clientResponse.ok) {
          throw new Error('Failed to update client');
        }
        
        // Handle plan assignment
        if (planId) {
          // First, remove any existing active plan
          const currentPlanResponse = await fetch(`/api/client-plans/${clientId}`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          if (currentPlanResponse.ok) {
            const currentPlans = await currentPlanResponse.json();
            const activePlan = Array.isArray(currentPlans) ? 
              currentPlans.find(cp => cp.status === 'active') : currentPlans;
            
            if (activePlan && activePlan.id) {
              await fetch(`/api/client-plans/${activePlan.id}`, {
                method: 'DELETE',
                headers: {
                  'Authorization': `Bearer ${token}`
                }
              });
            }
          }
          
          // Now assign the new plan
          const planAssignmentData = {
            client_id: clientId,
            plan_id: planId,
            status: 'active'
          };
          
          
          const planResponse = await fetch('/api/client-plans', {
            method: 'POST',
            headers: {
              'Content-Type': 'application/json',
              'Authorization': `Bearer ${token}`
            },
            body: JSON.stringify(planAssignmentData)
          });
          
          if (!planResponse.ok) {
            throw new Error('Failed to update client plan');
          }
        } else {
          // Remove current plan if "No Plan Selected"
          // First, find the client's current plan assignment
          const currentPlanResponse = await fetch(`/api/client-plans/${clientId}`, {
            headers: {
              'Authorization': `Bearer ${token}`
            }
          });
          
          if (currentPlanResponse.ok) {
            const currentPlans = await currentPlanResponse.json();
            // Find active plan and remove it
            const activePlan = Array.isArray(currentPlans) ? 
              currentPlans.find(cp => cp.status === 'active') : currentPlans;
            
            if (activePlan && activePlan.id) {
              const removeResponse = await fetch(`/api/client-plans/${activePlan.id}`, {
                method: 'DELETE',
                headers: {
                  'Authorization': `Bearer ${token}`
                }
              });
            }
          }
          // Don't throw error if no plan to remove
        }
        
        showNotification('Success', 'Client and plan updated successfully', 'success');
        closeEditModal();
        loadClients();
      } catch (error) {
        console.error('Error updating client:', error);
        showNotification('Error', 'Failed to update client or plan', 'error');
      }
    });

    // Initialize
    document.addEventListener('DOMContentLoaded', function() {
      // Check if user is logged in
      const token = localStorage.getItem('auth_token');
      if (!token) {
        window.location.href = '/login.html';
        return;
      }

      // Set up logout functionality
      document.getElementById('logoutBtn').addEventListener('click', function() {
        localStorage.removeItem('auth_token');
        showNotification('Logged Out', 'You have been successfully logged out', 'info');
        setTimeout(() => {
          window.location.href = '/login.html';
        }, 1000);
      });

      // Set up search and filters
      document.getElementById('clientSearch').addEventListener('input', debounce(filterClients, 300));
      document.getElementById('statusFilter').addEventListener('change', filterClients);
      document.getElementById('paymentStatusFilter').addEventListener('change', filterClients);
      document.getElementById('itemsPerPage').addEventListener('change', function() {
        itemsPerPage = parseInt(this.value);
        currentPage = 1;
        loadClients();
      });

      // Load initial data
      loadClients();
      loadPlans();
      
      // Fetch user info
      fetchUserInfo();
    });

    // Debounce function for search input
    function debounce(func, wait) {
      let timeout;
      return function executedFunction(...args) {
        const later = () => {
          clearTimeout(timeout);
          func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
      };
    }
    
    async function fetchUserInfo() {
      const token = localStorage.getItem('auth_token');
      try {
        const response = await fetch('/api/auth/me', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          document.getElementById('username').textContent = data.user.username || 'User';
        } else {
          localStorage.removeItem('auth_token');
          window.location.href = '/login.html';
        }
      } catch (error) {
        console.error('Error fetching user info:', error);
        document.getElementById('username').textContent = 'User';
      }
    }

    // MikroTik Import Functions
    let mikrotikAccounts = [];

    function showImportState(state) {
      const loading = document.getElementById('importLoading');
      const error = document.getElementById('importError');
      const accounts = document.getElementById('importAccounts');
      
      loading.classList.add('hidden');
      error.classList.add('hidden');
      accounts.classList.add('hidden');
      
      switch(state) {
        case 'loading':
          loading.classList.remove('hidden');
          break;
        case 'error':
          error.classList.remove('hidden');
          break;
        case 'accounts':
          accounts.classList.remove('hidden');
          break;
      }
    }

    async function fetchMikroTikAccounts() {
      const token = localStorage.getItem('auth_token');
      
      try {
        const response = await fetch('/api/ppp-accounts', {
          headers: {
            'Authorization': `Bearer ${token}`
          }
        });
        
        if (response.ok) {
          const data = await response.json();
          mikrotikAccounts = data.success ? (data.accounts || []) : [];
          renderMikroTikAccounts();
          showImportState('accounts');
        } else {
          const errorData = await response.json();
          let errorMessage = errorData.error || 'Failed to fetch MikroTik accounts';
          if (errorData.details) {
            errorMessage += '\nDetails: ' + errorData.details;
          }
          document.getElementById('importErrorMessage').textContent = errorMessage;
          showImportState('error');
        }
      } catch (error) {
        console.error('Error fetching MikroTik accounts:', error);
        document.getElementById('importErrorMessage').textContent = 
          'Network error: ' + error.message;
        showImportState('error');
      }
    }

    function renderMikroTikAccounts() {
      const tbody = document.getElementById('accountsList');
      
      // Ensure mikrotikAccounts is an array
      if (!Array.isArray(mikrotikAccounts)) {
        mikrotikAccounts = [];
      }
      
      if (mikrotikAccounts.length === 0) {
        tbody.innerHTML = `
          <tr>
            <td colspan="5" class="px-4 py-8 text-center text-gray-500">
              No PPPoE accounts found on MikroTik router.
            </td>
          </tr>
        `;
        return;
      }

      // Get all existing client names (normalized)
      const existingClientNames = new Set(
        clients.map(client => client.name.toLowerCase().trim())
      );

      tbody.innerHTML = mikrotikAccounts.map((account, index) => {
        const accountName = (account.name || account.user || '').toLowerCase().trim();
        const isExistingClient = existingClientNames.has(accountName);
        
        return `
          <tr class="hover:bg-gray-50 ${isExistingClient ? 'bg-yellow-50' : ''}">
            <td class="px-4 py-2">
              <input 
                type="checkbox" 
                id="account-${index}"
                value="${index}"
                onchange="updateSelectedCount()"
                class="rounded border-gray-300 text-blue-600 focus:ring-2 focus:ring-blue-500"
              >
            </td>
            <td class="px-4 py-2 text-sm font-medium text-gray-900">
              ${account.name || account.user || 'Unknown'}
              ${isExistingClient ? '<span class="ml-2 text-xs text-yellow-600 font-normal">(Already exists)</span>' : ''}
            </td>
            <td class="px-4 py-2 text-sm text-gray-500">${account.profile || '-'}</td>
            <td class="px-4 py-2 text-sm text-gray-500 max-w-48 truncate" title="${account.comment || '-'}">${account.comment || '-'}</td>
            <td class="px-4 py-2">
              <span class="inline-flex px-2 py-1 text-xs font-semibold rounded-full ${
                account.disabled === 'false' || !account.disabled ? 
                'bg-green-100 text-green-800' : 'bg-red-100 text-red-800'
              }">
                ${account.disabled === 'false' || !account.disabled ? 'Active' : 'Disabled'}
              </span>
            </td>
          </tr>
        `;
      }).join('');
      
      updateSelectedCount();
    }

    function toggleAllAccounts(checkbox) {
      const accountCheckboxes = document.querySelectorAll('input[id^="account-"]');
      accountCheckboxes.forEach(cb => cb.checked = checkbox.checked);
      updateSelectedCount();
    }

    function selectAllAccounts() {
      const selectAllCheckbox = document.getElementById('selectAllCheckbox');
      selectAllCheckbox.checked = true;
      toggleAllAccounts(selectAllCheckbox);
    }

    function selectAllNewClients() {
      // First, uncheck all
      const selectAllCheckbox = document.getElementById('selectAllCheckbox');
      selectAllCheckbox.checked = false;
      toggleAllAccounts(selectAllCheckbox);
      
      // Get all existing client names (normalized)
      const existingClientNames = new Set(
        clients.map(client => client.name.toLowerCase().trim())
      );
      
      // Check only accounts that don't exist in the clients list
      const accountCheckboxes = document.querySelectorAll('input[id^="account-"]');
      accountCheckboxes.forEach((checkbox, index) => {
        if (mikrotikAccounts[index]) {
          const accountName = (mikrotikAccounts[index].name || mikrotikAccounts[index].user || '').toLowerCase().trim();
          // Check the checkbox only if this account name doesn't exist in clients
          checkbox.checked = !existingClientNames.has(accountName);
        }
      });
      
      updateSelectedCount();
      updateSelectAllCheckboxState();
    }

    function selectNoneAccounts() {
      const selectAllCheckbox = document.getElementById('selectAllCheckbox');
      selectAllCheckbox.checked = false;
      toggleAllAccounts(selectAllCheckbox);
    }

    function updateSelectedCount() {
      const selectedCheckboxes = document.querySelectorAll('input[id^="account-"]:checked');
      const count = selectedCheckboxes.length;
      
      document.getElementById('selectedCount').textContent = `${count} selected`;
      document.getElementById('importSelectedBtn').disabled = count === 0;
      
      updateSelectAllCheckboxState();
    }
    
    function updateSelectAllCheckboxState() {
      // Update select all checkbox state
      const totalCheckboxes = document.querySelectorAll('input[id^="account-"]');
      const selectedCheckboxes = document.querySelectorAll('input[id^="account-"]:checked');
      const selectAllCheckbox = document.getElementById('selectAllCheckbox');
      const count = selectedCheckboxes.length;
      
      if (count === 0) {
        selectAllCheckbox.indeterminate = false;
        selectAllCheckbox.checked = false;
      } else if (count === totalCheckboxes.length) {
        selectAllCheckbox.indeterminate = false;
        selectAllCheckbox.checked = true;
      } else {
        selectAllCheckbox.indeterminate = true;
      }
    }

    async function importSelectedAccounts() {
      const selectedCheckboxes = document.querySelectorAll('input[id^="account-"]:checked');
      const selectedAccounts = Array.from(selectedCheckboxes).map(checkbox => {
        const index = parseInt(checkbox.value);
        return Array.isArray(mikrotikAccounts) ? mikrotikAccounts[index] : null;
      }).filter(account => account !== null);
      
      if (selectedAccounts.length === 0) {
        showNotification('Warning', 'Please select at least one account to import', 'warning');
        return;
      }
      
      const token = localStorage.getItem('auth_token');
      const importBtn = document.getElementById('importSelectedBtn');
      const originalText = importBtn.textContent;
      
      try {
        importBtn.disabled = true;
        importBtn.textContent = 'Importing...';
        
        const response = await fetch('/api/import-clients', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': `Bearer ${token}`
          },
          body: JSON.stringify({ selectedAccounts })
        });
        
        if (response.ok) {
          const result = await response.json();
          
          // Show detailed import results
          let message = result.message || `Successfully imported ${result.imported || 0} clients`;
          if (result.errorDetails && result.errorDetails.length > 0) {
            message += '\n\nErrors encountered:\n' + result.errorDetails.join('\n');
          }
          
          const notificationType = result.errors > 0 ? 'warning' : 'success';
          showNotification('Import Results', message, notificationType);
          
          closeImportModal();
          loadClients(); // Refresh client list
        } else {
          const errorData = await response.json();
          let errorMessage = errorData.error || 'Failed to import clients';
          if (errorData.details) {
            errorMessage += '\nDetails: ' + errorData.details;
          }
          throw new Error(errorMessage);
        }
      } catch (error) {
        console.error('Error importing clients:', error);
        showNotification('Error', 'Failed to import clients: ' + error.message, 'error');
      } finally {
        importBtn.disabled = false;
        importBtn.textContent = originalText;
      }
    }

    // Delete All Clients functionality
    async function confirmDeleteAll() {
      if (confirm('⚠️ WARNING: This will permanently delete ALL clients and their associated data (plans, billings, payments). This action cannot be undone.\n\nAre you sure you want to continue?')) {
        if (confirm('This is your FINAL confirmation. All client data will be lost forever. Type OK to proceed.')) {
          await deleteAllClients();
        }
      }
    }

    async function deleteAllClients() {
      const token = localStorage.getItem('token');
      const deleteBtn = document.getElementById('deleteAllBtn');
      const originalText = deleteBtn.innerHTML;
      
      try {
        deleteBtn.disabled = true;
        deleteBtn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2"></i>Deleting...';
        
        const response = await fetch('/api/clients/delete-all', {
          method: 'DELETE',
          headers: {
            'Content-Type': 'application/json'
          }
        });
        
        if (response.ok) {
          const result = await response.json();
          showNotification('Success', `Successfully deleted all clients. ${result.deleted || 0} clients removed.`, 'success');
          loadClients(); // Refresh client list
        } else {
          const errorData = await response.json();
          throw new Error(errorData.error || 'Failed to delete clients');
        }
      } catch (error) {
        console.error('Error deleting clients:', error);
        showNotification('Error', 'Failed to delete clients: ' + error.message, 'error');
      } finally {
        deleteBtn.disabled = false;
        deleteBtn.innerHTML = originalText;
      }
    }

    // Mobile Menu Functionality
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const mobileMenuOverlay = document.getElementById('mobileMenuOverlay');
    const sidebar = document.getElementById('sidebar');

    function toggleMobileMenu() {
      sidebar.classList.toggle('-translate-x-full');
      mobileMenuOverlay.classList.toggle('hidden');
      document.body.classList.toggle('overflow-hidden');
    }

    function closeMobileMenu() {
      sidebar.classList.add('-translate-x-full');
      mobileMenuOverlay.classList.add('hidden');
      document.body.classList.remove('overflow-hidden');
    }

    mobileMenuBtn.addEventListener('click', toggleMobileMenu);
    mobileMenuOverlay.addEventListener('click', closeMobileMenu);

    // Close mobile menu when clicking on navigation links
    const navLinks = sidebar.querySelectorAll('nav a');
    navLinks.forEach(link => {
      link.addEventListener('click', closeMobileMenu);
    });

    // Handle resize events
    window.addEventListener('resize', () => {
      if (window.innerWidth >= 1024) { // lg breakpoint
        closeMobileMenu();
      }
    });

  </script>
</body>
</html>